<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="First to cross the finish line wins!"><!-- <meta property="og:title" content="Ride the Pony"> --><!-- <meta property="og:description" content="My description"> --><!-- <meta property="og:type" content="website"> --><!-- <meta property="og:image" content="https://via.placeholder.com/500"> --><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Monoton&display=fallback" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,400;0,700;1,900&display=fallback" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><!-- <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png"> --><!-- <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png"> --><title>Ride the Pony</title><style>a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}body{line-height:1}body{background-color:#fff;color:#333;font-family:Lato,Arial,Helvetica,sans-serif}a{color:inherit;text-decoration:none}a,button,input{font-family:Lato,Arial,Helvetica,sans-serif}button{background-color:#222;border:none;border-radius:2px;color:#fff;cursor:pointer;font-size:21px;padding:15px;width:100%}button:active{border:1px solid #333;color:#333;outline:1px solid #333}button:focus{border:1px solid #333;color:#333;outline:1px solid #333}input{box-sizing:border-box;font-family:Lato,Arial,Helvetica,sans-serif;font-size:30px;font-weight:400;margin-bottom:40px;width:100%}label{font-family:Lato,Arial,Helvetica,sans-serif;font-size:21px;font-weight:200}.hidden{display:none!important}.hide{display:none!important}.invisible{visibility:hidden}.spacer{border-bottom:1px dashed #777;margin:10px 0}.page-wrapper{margin:0 auto;max-width:1000px;padding:10px 30px}.button-wrapper{text-align:center;padding:10px 0}.container{padding-bottom:30px}.room-code{text-transform:uppercase}.bold{font-weight:700}.bold.link{font-weight:700;padding:10px 0}.header{width:100vw;text-align:center;background-color:#222;color:#fff;font-weight:200;padding:10px 0}.header h1{color:#fff;font-family:Monoton,cursive;font-size:24px;font-weight:400;letter-spacing:2px;text-shadow:1px 2px #000;text-transform:uppercase}[data-screen=landing]{max-width:420px;margin:0 auto}[data-screen=landing] [data-input=room-code]{text-transform:uppercase}[data-screen=landing] button{color:#ff0;font-family:Monoton,cursive;font-weight:400;letter-spacing:2px;text-shadow:1px 2px #000;text-transform:uppercase}[data-screen=landing] .game-name{text-align:center;padding:10px;border:1px dashed #ccc;margin-bottom:20px;font-weight:400;font-size:18px}[data-screen=lobby]{font-size:20px;max-width:420px;margin:0 auto}[data-screen=lobby] button{max-width:250px}[data-screen=lobby] .game-info{text-align:center;padding:10px;border:1px dashed #ccc;margin-bottom:20px;font-weight:400;font-size:18px}[data-screen=lobby] .game-name{padding-bottom:10px}[data-group=host] [data-screen=lobby]{max-width:1000px;margin:0 auto}[data-group=host] [data-screen=lobby] .horse{height:54px;width:100px;margin-left:-100px;background-image:url(images/horse_still_frame.png);background-position:right;background-size:contain;background-repeat:no-repeat}[data-group=host] [data-screen=lobby] .track{border-bottom:1px dashed #333;padding-top:20px}[data-group=host] [data-screen=lobby] .waiting{text-align:center;padding:30px 0;text-transform:uppercase}[data-group=player] [data-screen=lobby] .section-title{text-align:center;border-bottom:1px dotted #333}[data-group=player] [data-screen=lobby] .player-list .player{padding:10px;border-bottom:1px dotted #ccc}[data-group=player] [data-screen=lobby] .menu{margin-bottom:20px}[data-group=player] [data-screen=lobby] .menu table{margin:0 auto;border-collapse:collapse}[data-group=player] [data-screen=lobby] .menu td{width:100px;height:54px;border:1px solid #ccc}[data-group=player] [data-screen=lobby] .menu button{width:100%;height:100%;background-color:transparent;background-image:url(images/horse_still_frame.png);background-size:contain;background-repeat:no-repeat;background-position:center}[data-group=player] [data-screen=lobby] .menu button[data-hue='0']{filter:hue-rotate(0)}[data-group=player] [data-screen=lobby] .menu button[data-hue='40']{filter:hue-rotate(40deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='80']{filter:hue-rotate(80deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='120']{filter:hue-rotate(120deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='160']{filter:hue-rotate(160deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='200']{filter:hue-rotate(200deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='240']{filter:hue-rotate(240deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='280']{filter:hue-rotate(280deg)}[data-group=player] [data-screen=lobby] .menu button[data-hue='320']{filter:hue-rotate(320deg)}[data-screen=gameIntro]{max-width:1000px;margin:0 auto}[data-screen=gameIntro] .game-info{text-align:center;padding:10px;border:1px dashed #ccc;margin-bottom:20px;font-weight:400;font-size:18px}[data-screen=gameIntro] .game-name{padding-bottom:10px}[data-screen=gameIntro] .horse{height:54px;width:100px;margin-left:-100px;background-image:url(images/horse_still_frame.png);background-size:contain;background-repeat:no-repeat;background-position:right}[data-screen=gameIntro] .tracks{margin-bottom:20px}[data-screen=gameIntro] .tracks.hot .horse{background-image:url(images/simple_cartoon_horse.gif);transition:all 1s linear}[data-screen=gameIntro] .track{border-bottom:1px dashed #333;padding-top:20px}[data-screen=gameIntro] .race-again{text-align:center}[data-screen=gameIntro] .race-again button{max-width:200px;text-transform:capitalize}</style></head><body><div class="header"><h1>tipsy.games</h1></div><div class="page-wrapper"><div class="container" data-screen="landing"><div class="game-name">Ride the Pony</div><div><label>Room Code</label><input data-input="room-code" type="text" placeholder="AAAA"></div><div><label>Player Name</label><input data-input="player-name" type="text" placeholder="guest"></div><div class="button-wrapper"><button data-action="joinGame">Join Game</button></div><div class="spacer"></div><div class="button-wrapper"><button data-action="newGame">New Game</button></div></div><div data-group="host"><div class="container hidden" data-screen="lobby"><div data-group="host"><div><div class="game-info"><div class="game-name">Ride the Pony</div><div class="room-code bold"></div></div></div><div class="tracks"></div><div class="waiting">waiting for players to join</div><div class="start-game-wrapper"><div class="button-wrapper hide"><button data-action="startGame">Start Race</button></div></div></div></div><div class="container hidden" data-screen="gameIntro"><div data-group="host"><div><div class="game-info"><div class="game-name">Ride the Pony</div><div class="countdown bold"></div><div class="leader bold hide">GO</div></div></div><div class="tracks"></div><div class="race-again hide"><button data-action="raceAgain">race again</button></div></div></div></div><div data-group="player"><div class="container hidden" data-screen="lobby"><div data-group="player"><div class="game-info"><div class="game-name">Ride the Pony</div><div class="room-code bold"></div></div><div class="menu"><table><tbody><tr><td><button data-hue="0" data-action="selectPony"></button></td><td><button data-hue="40" data-action="selectPony"></button></td><td><button data-hue="80" data-action="selectPony"></button></td></tr><tr><td><button data-hue="120" data-action="selectPony"></button></td><td><button data-hue="160" data-action="selectPony"></button></td><td><button data-hue="200" data-action="selectPony"></button></td></tr><tr><td><button data-hue="240" data-action="selectPony"></button></td><td><button data-hue="280" data-action="selectPony"></button></td><td><button data-hue="320" data-action="selectPony"></button></td></tr></tbody></table></div><div><div class="section-title">Player List</div><div class="player-list"></div></div></div></div><div class="container hidden" data-screen="gameIntro"><div>The Player's Game</div></div></div></div><script>!function(){"use strict";function e(e){console.log("display screen:",e),document.querySelectorAll("[data-screen]").forEach(e=>{e.classList.add("hidden")}),document.querySelector(`[data-screen="${e}"]`).classList.remove("hidden"),window.app.screen=e}function o(){console.log("render the lobby");const{code:e,playerList:o}=window.app.host;e&&a(e),n(o),t(o,2),console.log("beginning to render the lobby")}function t(e,o){const t=Object.keys(e).length,n=document.querySelector('[data-screen="lobby"] button[data-action="startGame"]').parentNode;t<o?n.classList.add("hide"):n.classList.remove("hide")}function n(e){console.log("update player list",e);let o=Object.keys(e).map(o=>{const{playerName:t,hue:n}=e[o];return`<div class="track"><div class="horse" style="filter: hue-rotate(${n}deg)"></div><div class="player-name">${t}</div></div>`}).join("");document.querySelector('[data-screen="lobby"] .tracks').innerHTML=o}function a(e){document.querySelector('[data-screen="lobby"] .room-code').innerText=e}function r(){const{host:e,player:o}=window.app;return e&&e.ref?e.ref:o&&o.ref?o.ref:void 0}let c,s="",l=!0,i=!0;function d(){console.log("render game intro"),i&&(i=!1,s=document.querySelector('[data-screen="gameIntro"]').innerHTML),u()}async function u(){l&&(l=!1,document.querySelector('[data-screen="gameIntro"]').innerHTML=s,w(),y())}async function y(){const e=Math.floor(Date.now()/1e3)+10;c=b();const o=r();await o.update({outcome:JSON.stringify(c),race_time:e}).then(()=>{p(e)})}function p(e){const o=Math.floor(Date.now()/1e3),t=e-o;t<=0?m():(document.querySelector('[data-screen="gameIntro"] .countdown').innerHTML=t,setTimeout(()=>{p(e)},1e3))}function m(){console.log("start race!!"),document.querySelector('[data-screen="gameIntro"] .countdown').classList.add("hide"),document.querySelector('[data-screen="gameIntro"] .leader').classList.remove("hide"),document.querySelector('[data-screen="gameIntro"] .tracks').classList.add("hot"),f()}function f(){console.log("move horses:",c);let e=0;const o=h(c),t=setInterval(()=>{console.log("move horses",e);const n=c.map(e=>e.frame).sort((e,o)=>e-o);console.log("frames:",n);for(let o=0;o<c.length;o++){const{distances:t}=c[o],a=document.querySelector(`[data-screen="gameIntro"] .track[data-key="${c[o].player}"] .horse`);console.log("distance",t[e]),e>=n[0]?g(a,40):g(a,t[e])}e>=n[0]+1&&(clearInterval(t),setTimeout(()=>{document.querySelector('[data-screen="gameIntro"] .tracks').classList.remove("hot"),document.querySelector('[data-screen="gameIntro"] .race-again').classList.remove("hide"),document.querySelector('[data-screen="gameIntro"] .leader').innerHTML="winner: "+o,l=!0},1e3)),e+=1},1e3)}function g(e,o){console.log("move horse:",e,o),e.style.marginLeft=parseInt(e.style.marginLeft,10)+o+"px"}function h(e){const o=e.sort((e,o)=>e.frame-o.frame),t=o.filter(e=>e.frame===o[0].frame).sort((e,o)=>e.steps-o.steps)[0];console.log("==== GET WINNER ",t);const{playerName:n}=window.app.host.playerList[t.player];return console.log("==== PLAYER NAME ",n),n}function w(){const{playerList:e}=app.host;console.log("update player list",e);let o=Object.keys(e).map(o=>{const{playerName:t,hue:n}=e[o];return`<div class="track" data-key=${o}><div class="horse" style="margin-left: -100px; filter: hue-rotate(${n}deg)"></div><div class="player-name">${t}</div></div>`}).join("");document.querySelector('[data-screen="gameIntro"] .tracks').innerHTML=o}function b(){const{playerList:e}=window.app.host;return Object.keys(e).map(e=>{let o=[],t=0,n=0,a=0;for(let e=0;e<100;e++){const r=v(30,40);if(t+r>=960){n=e,a=960-t;break}o.push(r),t+=r}return{distances:o,frame:n,player:e,steps:a}})}function v(e,o){return Math.floor(Math.random()*(o-e+1))+e}const L={gameIntro:d,lobby:o};function S(){console.log("render the lobby");const{code:e,playerList:o}=window.app.player;e&&k(e),o&&q(o),console.log("beginning to render the lobby")}function q(e){console.log("update player list",e);document.querySelector('[data-screen="lobby"] .player-list').innerHTML=Object.keys(e).map(o=>`<div class="player">${e[o].playerName}</div>`).join("")}function k(e){document.querySelector('[data-screen="lobby"] .room-code').innerText=e}const I=()=>{console.log("render game intro")},N={lobby:S,gameIntro:I},T=[],M=()=>{T.push(...arguments)},j=()=>{window.console.log(T.join("\n"))};async function O({playerType:o,screen:t}){M();const n={host:L,player:N};await n[o][t]&&n[o][t](),e(t)}function $(e){console.log("on player list updated",e),window.app.player.playerList=e.exists()?e.toJSON():{},O({playerType:"player",screen:"lobby"})}const H=e=>{M();const o=e.exists()?e.toJSON():"";o&&O({playerType:"player",screen:o})};function x(e){const o=decodeURIComponent(document.cookie).split("; ").map(e=>e.split(/=/)).filter(o=>o[0]===e);return o.length?o[0][1]:""}function E(e,o){try{document.cookie=`${e}=${o}`}catch(e){console.error("tried to cache data in a cookie:",e)}}async function G({code:o}){console.log("new player");const t=window.firebase.database().ref("rooms/"+o);let n="";const a=J();return E("playerName",a),await t.child("players").push({playerName:a,hue:"0"}).then(o=>{console.log("player set"),n=o.getKey(),t.child("players").child(n).onDisconnect().remove(),console.log("display lobby"),e("lobby")}),{code:o,listen:A,playerKey:n,playerList:"",ref:t}}function J(){return console.log("get player name"),document.querySelector('[data-input="player-name"]').value||"guest"}function A(){console.log("listening");const{ref:e}=window.app.player;e.child("players").on("value",$),e.child("screen").on("value",H)}var D={createNewPlayer:G};const P={displayLog:j};let K=!0;const R=()=>(M(),document.querySelector('[data-input="room-code"]').value.toLowerCase()),C=async()=>{if(!K)return;const{player:e}=window.app;if(e)return;K=!1;const o=R(),t=window.firebase.database().ref("rooms/"+o);let n=!1;await t.once("value").then(e=>{const{screen:o}=e.toJSON()||{};"lobby"===o?n=!0:K=!0}),n&&(document.querySelector('[data-group="host"]').remove(),P.player=await D.createNewPlayer({code:o}),P.player.listen())},z=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];function U(){const e=[];for(let o=0;o<4;o++)e[o]=W(z);return e.join("")}function W(e){return e[Math.floor(Math.random()*e.length)]}function Y(e){console.log("on player list updated",e),window.app.host.playerList=e.exists()?e.toJSON():{},O({playerType:"host",screen:"lobby"})}async function _(){console.log("new host");const e=U(),o=window.firebase.database().ref("rooms/"+e);console.log("ref:",o);return await o.onDisconnect().remove(),console.log("ref set lobby"),await o.set({screen:"lobby"}),{code:e,listen:B,playerList:"",ref:o}}function B(){console.log("listening");const{ref:e}=window.app.host;e.child("players").on("value",Y)}var F={createNewHost:_};let Q=!0;async function V(){const{host:e}=window.app;e||Q&&(Q=!1,document.querySelector('[data-group="player"]').remove(),P.host=await F.createNewHost(),P.host.listen(),O({playerType:"host",screen:"lobby"}))}async function X(e){const o=r();await o.update({screen:e}).then(()=>{O({screen:e,playerType:"host"})})}async function Z(){console.log("start game");const{screen:e}=window.app;"gameIntro"!==e&&X("gameIntro")}let ee=!0;async function oe(e){if(!ee)return;const{hue:o}=e.target.dataset;ee=!1;const t=r(),{playerKey:n}=window.app.player;await t.child("players").child(n).update({hue:o}).then(()=>{console.log("hue is set:",o),ee=!0})}function te(){console.log("race again"),X("lobby")}const ne={joinGame:C,newGame:V,startGame:Z,selectPony:oe,raceAgain:te};function ae(e){console.log("clicked:",e);const o=e.target.dataset.action||"";ne[o]&&ne[o](e)}const re=()=>{M(),document.addEventListener("click",ae,!1)},ce=()=>{M();const e=x("playerName");e&&(document.querySelector('[data-input="player-name"]').value=e)},se=()=>{M(),window.app=P,ce(),re()};window.addEventListener("load",se)}()</script><!-- The core Firebase JS SDK is always required and must be listed first --><script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-database.js"></script><!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries --><script>var firebaseConfig={apiKey:"AIzaSyBCf6ie1SYSt1u3RNSuwOc2N4Ld-m3C6zA",authDomain:"climb-00.firebaseapp.com",databaseURL:"https://climb-00.firebaseio.com",projectId:"climb-00",storageBucket:"climb-00.appspot.com",messagingSenderId:"735552551317",appId:"1:735552551317:web:0b3bbefcc0b17337289e9c"};firebase.initializeApp(firebaseConfig)</script></body></html>